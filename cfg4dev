configure_dev_env()
{
    if [ ! -f "$PWD/requirements.txt" ]; then
        echo "Must source this script from project's root directory" >&2
        return 1
    fi

    if [ -d "$PWD/env" ]; then
        source "$PWD/env/bin/activate"
    else
        virtualenv env
        source "$PWD/env/bin/activate"

        #
        # pip & setuptools install is here to fix the problem
        # introduced with setuptools v34 and described well
        # in this bug
        #
        #   https://github.com/pypa/setuptools/issues/942
        #
        pip install -U pip
        pip install setuptools==33.1.1

        pip install --requirement "$PWD/requirements.txt"
    fi

    export PATH="$PWD/bin":$PATH
    export PYTHONPATH="$PWD"

    if [ "" != "`which Xvfb`" ]; then
        if [ "" == "$DISPLAY" ]; then
            export DISPLAY=:99
        fi
        ps cax | grep Xvfb > /dev/null
        if [ $? -ne 0 ]; then
            Xvfb $DISPLAY -ac -screen 0 1280x1024x24 >& /dev/null &
            echo "Xvfb started on display \"$DISPLAY\""
        fi
    fi

    return 0
}

configure_dev_env
